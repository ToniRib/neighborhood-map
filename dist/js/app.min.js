var map,infoWindow=new google.maps.InfoWindow({content:'<div><h4 id="brewery-name"></h4><p id="brewery-address"></p><p id="yelp"></p></div>'}),ViewModel=function(){var a=this;this.breweryList=ko.observableArray([]),this.filteredBreweryList=ko.observableArray([]),a.initialize=function(){var a=document.getElementById("google-map"),b=new google.maps.LatLng(39.711502,-104.920702),c={center:b,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(a,c)},a.buildBreweryLocations=function(){breweryLocations.forEach(function(b){a.breweryList.push(new Brewery(b))})},a.setBreweryClickFunctions=function(){a.breweryList().forEach(function(b){google.maps.event.addListener(b.marker(),"click",function(){a.breweryClick(b)})})},a.breweryClick=function(b){infoContent='<div><h4 id="brewery-name">'+b.name()+'</h4><h5 id="brewery-address">'+b.address()+'</h5><h6 id="brewery-neighborhood">'+b.neighborhood()+'</h6><p>Rating on <a id="yelp-url">yelp</a>: <img id="yelp"></p></div>',infoWindow.setContent(infoContent),a.getYelpData(b),infoWindow.open(map,b.marker()),a.setMarkerAnimation(b)},a.setMarkerAnimation=function(a){a.marker().setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.marker().setAnimation(null)},750)},a.filterBreweries=function(){a.filteredBreweryList([]);for(var b=$("#search-str").val().toLowerCase(),c=a.breweryList().length,d=0;c>d;d++){var e=a.breweryList()[d].name().toLowerCase(),f=a.breweryList()[d].neighborhood().toLowerCase();e.indexOf(b)>-1||f.indexOf(b)>-1?(a.filteredBreweryList.push(a.breweryList()[d]),a.breweryList()[d].marker().setMap(map)):a.breweryList()[d].marker().setMap(null)}},a.getYelpData=function(a){var b="GET",c="http://api.yelp.com/v2/search/",d=function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;a>d;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},e={oauth_consumer_key:"S46AQ1iwQtvxw_D1wQLHZA",oauth_token:"TO9rPx1abdPe3lllR5Wo3WFrvz8CV9vw",oauth_nonce:d(20),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:a.name(),location:"Denver, CO",limit:1};console.log(e);var f="8hqIHpplfRBLzs6YOqLZFfkx7jg",g="evb3bjTox8RNlfZ5Ma74hqJjZWo",h=oauthSignature.generate(b,c,e,f,g);e.oauth_signature=h;var i={url:c,data:e,cache:!0,dataType:"jsonp",success:function(a){$("#yelp").attr("src",a.businesses[0].rating_img_url),$("#yelp-url").attr("href",a.businesses[0].url),console.log(a)}};$.ajax(i)},google.maps.event.addDomListener(window,"load",function(){a.initialize(),a.buildBreweryLocations(),a.setBreweryClickFunctions(),a.filteredBreweryList(a.breweryList())})},Brewery=function(a){var b;this.name=ko.observable(a.name),this.lat=ko.observable(a.lat),this.lng=ko.observable(a.lng),this.address=ko.observable(a.address),this.neighborhood=ko.observable(a.neighborhood),b=new google.maps.Marker({position:new google.maps.LatLng(this.lat(),this.lng()),map:map,title:this.name()}),this.marker=ko.observable(b)};ko.applyBindings(new ViewModel);